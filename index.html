<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Chillverse — Server Widget</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --accent:#6C7CFF;
    --glass: rgba(255,255,255,0.04);
    --glass-2: rgba(255,255,255,0.03);
    --card-radius:18px;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;color:#e9eef8}
  body{
    background:linear-gradient(180deg, rgba(15,18,25,0.85), rgba(8,10,12,0.85)), #0b0c0f;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:28px;
    /* background image (unsplash random calm sea). change query to taste */
    background-image:
      radial-gradient(circle at 10% 10%, rgba(255,255,255,0.02), transparent 10%),
      url("https://source.unsplash.com/1600x900/?calm,sea,sunset");
    background-size:cover;
    background-position:center;
    filter: saturate(0.9) contrast(1.02);
  }

  /* subtle overlay */
  .overlay {
    position: absolute;
    inset: 0;
    background: linear-gradient(180deg, rgba(5,8,12,0.55), rgba(12,14,16,0.65));
    pointer-events: none;
  }

  .wrap {
    position: relative;
    z-index: 2;
    width: 420px;
    max-width:calc(100% - 48px);
  }

  .card {
    border-radius: var(--card-radius);
    overflow: hidden;
    background: linear-gradient(180deg, rgba(12,14,16,0.6), rgba(10,11,12,0.6));
    box-shadow: 0 12px 40px rgba(2,6,12,0.7), 0 2px 8px rgba(0,0,0,0.6);
    border: 1px solid rgba(255,255,255,0.03);
    backdrop-filter: blur(10px) saturate(1.1);
    padding: 18px;
  }

  .top {
    display:flex;
    align-items:center;
    gap:14px;
  }

  .server-icon {
    width:84px;
    height:84px;
    border-radius:16px;
    flex:0 0 84px;
    overflow:hidden;
    background:linear-gradient(135deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    display:grid;
    place-items:center;
    border: 1px solid rgba(255,255,255,0.02);
  }

  .server-icon img{width:100%;height:100%;object-fit:cover;display:block}

  .title {
    flex:1;
    min-width:0;
  }
  .title h1{
    margin:0;font-size:20px;font-weight:700;line-height:1.05;
    text-overflow:ellipsis;white-space:nowrap;overflow:hidden;
  }
  .title p{
    margin:6px 0 0;font-size:13px;color:rgba(233,238,248,0.75);
  }

  .status-row{
    display:flex;
    gap:10px;
    margin-top:12px;
    align-items:center;
  }
  .pill {
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    padding:8px 12px;border-radius:999px;
    font-weight:600;font-size:13px;color:var(--accent);
    display:inline-flex;align-items:center;gap:8px;border:1px solid rgba(108,124,255,0.12)
  }

  .big-invite{
    margin-top:16px;
    display:flex;gap:10px;align-items:center;justify-content:space-between;
  }

  .join-btn{
    background: linear-gradient(90deg,var(--accent), #5670ff);
    color:white;padding:12px 16px;border-radius:12px;font-weight:700;text-decoration:none;
    display:inline-flex;align-items:center;gap:10px;border:none;cursor:pointer;
    box-shadow: 0 6px 18px rgba(92,103,255,0.18);
  }
  .join-btn:hover{transform:translateY(-2px);transition:transform .18s ease}

  .player {
    margin-top:16px;
    display:flex;
    align-items:center;
    gap:12px;
  }

  .album {
    width:70px;height:70px;border-radius:10px;overflow:hidden;flex:0 0 70px;
    background:linear-gradient(135deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    display:grid;place-items:center;border:1px solid rgba(255,255,255,0.02);
  }
  .album img{width:100%;height:100%;object-fit:cover}

  .controls{flex:1;min-width:0}
  .track-title{font-weight:700;margin:0;font-size:14px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
  .track-artist{margin:6px 0 0;color:rgba(233,238,248,0.75);font-size:13px}

  .controls .buttons{display:flex;align-items:center;gap:8px;margin-top:10px}
  .btn {
    background:var(--glass);
    border-radius:10px;padding:8px 10px;border:1px solid rgba(255,255,255,0.02);
    cursor:pointer;font-weight:600;color:#dfe7ff;
  }
  .btn:hover{transform:translateY(-2px);transition:all .18s ease}
  .volume {display:flex;align-items:center;gap:8px;margin-left:8px}
  .volume input[type=range]{width:110px}

  .footer-note{margin-top:14px;color:rgba(233,238,248,0.6);font-size:12px;text-align:center}
  .small {font-size:11px;color:rgba(233,238,248,0.55)}

  /* responsive */
  @media (max-width:460px){
    .top{flex-direction:row}
    .server-icon{width:72px;height:72px}
    .album{width:56px;height:56px}
  }
</style>
</head>
<body>
  <div class="overlay" aria-hidden="true"></div>

  <div class="wrap">
    <div class="card" role="region" aria-label="Chillverse server widget">
      <div class="top">
        <div class="server-icon" id="serverIconWrap" title="Server icon">
          <!-- server icon inserted by JS -->
          <img id="serverIcon" alt="server icon" src="">
        </div>

        <div class="title">
          <h1 id="serverName">Loading Chillverse...</h1>
          <p id="serverDesc">Welcome — step into the chill.</p>

          <div class="status-row">
            <div class="pill" id="onlinePill">● Online: —</div>
            <div class="small" id="memberCount" style="margin-left:6px;color:rgba(233,238,248,0.68)">Members: —</div>
          </div>
        </div>
      </div>

      <div class="big-invite">
        <a id="joinBtn" class="join-btn" href="https://discord.gg/9C6VF4KFkV" target="_blank" rel="noopener">
          Join Chillverse
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" style="opacity:.95"><path d="M12 2v20M2 12h20" stroke="rgba(255,255,255,0.9)" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </a>
      </div>

      <div class="player" aria-hidden="false">
        <div class="album" id="albumWrap">
          <img id="albumArt" alt="album art" src="">
        </div>

        <div class="controls">
          <div class="track-title" id="trackTitle">Serene View</div>
          <div class="track-artist" id="trackArtist">Arulo — Mixkit (royalty-free)</div>

          <div class="buttons">
            <button class="btn" id="playBtn">Play ▶</button>
            <button class="btn" id="muteBtn">Muted</button>

            <div class="volume">
              <label class="small">Vol</label>
              <input type="range" id="volumeSlider" min="0" max="1" step="0.01" value="0.55" />
            </div>
          </div>
        </div>
      </div>

      <div class="footer-note">
        Music: Serene View — Mixkit (free). Background images from Unsplash. If server icon doesn’t appear, the server may have no icon or the widget is disabled. :contentReference[oaicite:2]{index=2}
      </div>
    </div>
  </div>

  <!-- Audio element (uses a Mixkit preview; if this 1-line link ever 404s you can swap to any MP3 URL) -->
  <audio id="bgAudio" loop crossorigin="anonymous">
    <source src="https://assets.mixkit.co/music/preview/mixkit-serene-view-443.mp3" type="audio/mpeg">
    Your browser does not support HTML audio.
  </audio>

<script>
  (function(){
    const GUILD_ID = "1413927989481308192";
    const WIDGET_JSON = `https://discord.com/api/guilds/${GUILD_ID}/widget.json`;
    const cdnIcon = (id, icon) => `https://cdn.discordapp.com/icons/${id}/${icon}.png?size=512`;
    const defaultIcon = "data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='512' height='512'><rect width='100%' height='100%' rx='40' fill='%23282b2f'/><text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' font-size='120' fill='%23cdd6f4' font-family='Arial'>C</text></svg>";

    // elements
    const serverName = document.getElementById("serverName");
    const serverDesc = document.getElementById("serverDesc");
    const serverIconImg = document.getElementById("serverIcon");
    const onlinePill = document.getElementById("onlinePill");
    const memberCount = document.getElementById("memberCount");
    const albumArt = document.getElementById("albumArt");
    const trackTitle = document.getElementById("trackTitle");
    const trackArtist = document.getElementById("trackArtist");
    const playBtn = document.getElementById("playBtn");
    const muteBtn = document.getElementById("muteBtn");
    const volumeSlider = document.getElementById("volumeSlider");
    const bgAudio = document.getElementById("bgAudio");

    // prefill album art and audio metadata
    albumArt.src = "https://images.unsplash.com/photo-1507525428034-b723cf961d3e?q=80&w=800&auto=format&fit=crop&crop=entropy";
    trackTitle.textContent = "Serene View";
    trackArtist.textContent = "Arulo — Mixkit (royalty-free)";

    // audio default
    bgAudio.volume = parseFloat(volumeSlider.value);
    bgAudio.muted = true; // start muted — browsers require user interaction for sound
    let isPlaying = false;

    // Play / Pause logic
    playBtn.addEventListener("click", async () => {
      try {
        if (!isPlaying) {
          await bgAudio.play();
          isPlaying = true;
          playBtn.textContent = "Pause ❚❚";
          // auto-unmute not performed to respect browser policies; user may toggle mute
        } else {
          bgAudio.pause();
          isPlaying = false;
          playBtn.textContent = "Play ▶";
        }
      } catch (err) {
        // play might be blocked — switch to muted autoplay then instruct user
        console.warn("Autoplay blocked; switching to muted autoplay", err);
        bgAudio.muted = true;
        await bgAudio.play().catch(()=>{});
        isPlaying = true;
        playBtn.textContent = "Pause ❚❚";
      }
    });

    muteBtn.addEventListener("click", () => {
      bgAudio.muted = !bgAudio.muted;
      muteBtn.textContent = bgAudio.muted ? "Muted" : "Unmuted";
    });

    volumeSlider.addEventListener("input", () => {
      bgAudio.volume = parseFloat(volumeSlider.value);
      if (bgAudio.volume === 0) { bgAudio.muted = true; muteBtn.textContent = "Muted"; }
      else { bgAudio.muted = false; muteBtn.textContent = "Unmuted"; }
    });

    // Load server widget JSON
    async function loadWidget(){
      try {
        const res = await fetch(WIDGET_JSON, {cache: "no-store"});
        if (!res.ok) throw new Error("widget fetch failed: " + res.status);
        const data = await res.json();

        // server name/desc
        serverName.textContent = data.name || "Chillverse";
        serverDesc.textContent = data.instant_invite ? "Live — click Join to enter" : "Invite available";

        // online & member counts
        const online = (typeof data.presence_count !== "undefined") ? data.presence_count : (data.members ? data.members.filter(m=>m.status!=="offline").length : "—");
        const total = (typeof data.members !== "undefined") ? data.members.length : "—";
        onlinePill.innerHTML = `● Online: ${online}`;
        memberCount.textContent = `Members: ${total}`;

        // server icon: prefer widget's icon_url OR construct from icon hash
        if (data.icon_url) {
          serverIconImg.src = data.icon_url;
        } else if (data.id && data.icon) {
          serverIconImg.src = cdnIcon(data.id, data.icon);
        } else {
          // fallback (tiny svg)
          serverIconImg.src = defaultIcon;
        }

        // small safety: if icon 404 or blocked, fallback to default
        serverIconImg.onerror = ()=> serverIconImg.src = defaultIcon;

      } catch (err) {
        console.warn("Could not load widget.json (CORS or disabled). Using best-effort fallback.", err);
        serverName.textContent = "Chillverse";
        serverDesc.textContent = "Invite: https://discord.gg/9C6VF4KFkV";
        onlinePill.textContent = "● Online: —";
        memberCount.textContent = "Members: —";
        serverIconImg.src = defaultIcon;
      }
    }

    // initialize
    loadWidget();

    // refresh every 90s
    setInterval(loadWidget, 90000);
  })();
</script>
</body>
</html>
